sudo: required
language: java
jdk:
- oraclejdk8
services:
- docker
branches:
  only:
  - master
env:
  global:
  - IMAGE=citizengaia/tomcat-base
  - CURRENT=1.0-SNAPSHOT
before_install:
- docker version
- docker info
after_success:
- mkdir -p '/tmp/logs/'
- docker tag $IMAGE:$CURRENT $IMAGE
- docker run --rm -d -p '8080:8080' -v '/tmp/logs:/hostfs/tomcat/logs' --name=tomcat $IMAGE
- curl -s -S -o responsefile http://localhost:8080/
- grep -E "OK" responsefile || echo "wrong response from tomcat base image"
- echo "OK response from tomcat base image"
- docker stop tomcat
- ls -lrt '/tmp/logs/'
- tail -10 '/tmp/logs/docker-entrypoint.log'
- docker login --username $dockerhub_user --password $dockerhub_pass
- docker push $IMAGE
- docker logout
notifications:
  slack:
    rooms:
      secure: zHg1SBuzTHibxWfRWLemMzk3ySoneRhXlfkcpucEny2Mf78XsIEO53XwpNcPmvX1fTFEoXh3BJp4pT/P2lDEqTpz24SZcX7j7aaIuC8QDH7JS/JlBkmtFJtiOes+m9ZpGGZxGI0GyBDtJOQHxkXAsS+IFBGoW5Ymq4nJHlobcY3cb81IqaSNfRGm6rPSdOx9ahNEPea4OL6keDwdDdsd3a+lnjJv7i0/vOQw5lPI2L4cmQQ9AvE+Kp7nHsuos9dGNRTdERijmH7DPhOFsNyQItfxW562PyMGZ8gge8NGHVNU9dd9fpTCgt7caacWHnGow19hVAzMzUK20ERsTJ6a/xWk6p81CzvK8GhyBA0diBpKzgZSQ2eobVku9uR64S3PHiFviLG6ZKqNgZschJNdgd0gbwOVZVDUD6OEFKb1vNHlYNJ3NaOXDehvpbw+LVqjulEbK3oqJswD/a7kbxqSW+t+z6HdUs8dFnl6gn9LUyIn3xz0qr4SWPHjC0uujAsFRLBmlC+QJ0Y2B9r67SnznHK4VTzlOEAAxmajfZ3N44zAHt/i0eyDgMtBcuWvRPXjkfTJsTP+cwNYpaPawBtjRlGNndg1a8ADNpkn/hwztZl74n7CwcKmhxZ3HJSGVO4AF2tCPvlXfpFAWDAW7CgezTq/AfTzAmbRjzAALcz5kiI=
    on_success: always

