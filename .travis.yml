sudo: required
language: java
jdk:
- oraclejdk8
services:
- docker
branches:
  only:
  - master
env:
  global:
  - IMAGE=citizengaia/tomcat-base
  - CURRENT=1.0-SNAPSHOT
before_install:
- docker version
- docker info
after_success:
- mkdir -p '/tmp/logs/'
- docker tag $IMAGE:$CURRENT $IMAGE
- docker run --rm -d -p '8080:8080' -v '/tmp/logs:/hostfs/tomcat/logs' --name=tomcat $IMAGE
- curl -s -S -o responsefile http://localhost:8080/
- grep -E "OK" responsefile || echo "wrong response from tomcat base image"
- echo "OK response from tomcat base image"
- docker stop tomcat
- ls -lrt '/tmp/logs/'
- tail -10 '/tmp/logs/docker-entrypoint.log'
- docker login --username $dockerhub_user --password $dockerhub_pass
- docker push $IMAGE
- docker logout
notifications:
  slack:
    rooms:
      secure: DXTZuRTlNuQucZto0ZYa5cEP6sBVGkSidbM3munoz8lom8x+RZieF9i+22IwVTAcHVibTlVqooKf83AIsLOX3cV3CjrobMSh4v/xX79EOB6ObnF9bZNJ9z1EGLpNd9I7TKh4nIzW7G2rbPkOnBMk+UN2buuDgg7MvULtEQCOkTXFRBaVqPtrdt8gXOP2aXglhk/QXrUXRNoJJH/uuvS4OvH40PY/cBMv7eCnNh39wbbWQj12xtEnhfO9K8TvPVOdZ7Y8RTNQLgKrTyfGGvvGQFzsUXA1Do61Gy7dOEiPnt7TsBYAmyBdEv/rvpME+GCVh5d+OM8IQCRIBHJlWNuN6vr8MIhm5gh2uteRPgsQL+B9fiTeatNjE92XYG5jvZenzco9z5R046iEmrjyLm45ZTZVpSUrglnEy1ufxzZYo/CqvrmirZrgI2UolzSwV93Jck8GhjRv2sZKB9kmwErXBaGT8pCsvHOXMiHpFOKugef6Ur+7RMzOsFE4MlzKlUMj5c7XDY3DNtvI5G45bg+fHvUVZnoqC4UWkse3z5nAaNlK1qFSzeLqcKMVjgnxOZEbp/Y4C9lD8/+351wMLbfBySIuGx4ve+o+SSoPbLhU1UAv2Hh70Pd59uR1LZEMUqDduxmvoEunApLqaXHBnhC/jMeEFINPvZhCK5xfEXEyCEA=
    on_success: always
