sudo: required
language: java
jdk:
- oraclejdk8
services:
- docker
branches:
  only:
  - master
env:
  global:
  - IMAGE=citizengaia/tomcat-base
  - CURRENT=1.0-SNAPSHOT
before_install:
- docker version
- docker info
after_success:
- mkdir -p '/tmp/logs/'
- docker tag $IMAGE:$CURRENT $IMAGE
- docker run --rm -d -p '8080:8080' -v '/tmp/logs:/hostfs/tomcat/logs' --name=tomcat $IMAGE
- curl -s -S -o responsefile http://localhost:8080/
- grep -E "OK" responsefile || echo "wrong response from tomcat base image"
- echo "OK response from tomcat base image"
- docker stop tomcat
- ls -lrt '/tmp/logs/'
- tail -10 '/tmp/logs/docker-entrypoint.log'
- docker login --username $dockerhub_user --password $dockerhub_pass
- docker push $IMAGE
- docker logout
notifications:
  slack:
    rooms:
      secure: ai2BrdHRBE6Ai/e2ZQV8Q/GrXo5qJp8vUsCjPVp3fot1cFOvLtgNcXPRIPa3sBgyHnFHCRI179RVqPQQQWeOrSfhGgB7zkUKjMDNU4YPEM5ogQmDPq7XXFm2OPOorXkUjy+wPWrHoq9fwecKj3ws2k/qwJzn1xpu+ybTO5lbINiBjtU3g4vHZNiv1Afzp5l6acdZJ8VVnCVz4yn6RW199OKxVfqj8lagMixh3J980W0J0m3paprCUoVrj0TlbibJuhiG3NNTzzja5O5wVZ9LY6O/YVeipTwlwup44xtFrix9LKueggRekJPHJNRke030N+W99ozZqG07to09RPSV6c+qM3wndW7IHki6lKRke3hwuhcWow5vzrewyTW7+CsXj4uM913wKBxQAKjCeivFyCK3GiS0OUmwl0sLiUCphCH+10LfqdLRM5NjbTLtucvtjT2SLCi0ZSXKK4SYWCEcOajsJQeD6+Y8cdyqLJqKY3VnELh/apoqwjjpx7ojdWrzhKW2MTE8cmBYW1UUgq1bS7nCtYtDTJIHNfu2lp0ZHq/xiTOkrrTlPRiI5psJXC0W20iZJjVD+fI0CQTCKoGnf+zi+/s/HpYPb/PLZsv6qzo0oOp/+VoYuhOcDKXSGgwdELY2CNn9bdajPICgGFPUs7cjndEXX4v2UsvX62PJYg0=
    on_success: always
